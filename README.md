# Описание проекта

### Dependencies
Install poetry
```
pip install poetry
```

### How to use web-app
Press the button `Browse files` to upload images

Press the button `Infer` to get the results

Press `Download` button to download the results

## Задача

В изначальной постановке задачи планировалось создание приложения, с помощью которого можно было бы по загруженной фотографии плана этажа получить ведомость с информацией о площадях её квартир и комнат.  
Однако, из-за отсутствия доступных датасетов с планами этажей, пришлось сузить область задачи до рамок одной квартиры.

## Данные на вход

Мною были найдены два датасета:  
- [Первый датасет](https://universe.roboflow.com/datathon24/krisha.kz/dataset/8)  
- [Второй датасет](https://universe.roboflow.com/nage/nagecad_rd/dataset/1)  

Они отличались объемом данных и размеченными классами:  
- В первом датасете классы: `['balcony', 'bathroom', 'hallway', 'kitchen', 'living_room', 'other', 'studio']`
- Во втором датасете классы: `['bathroom', 'bedroom', 'hallway', 'kitchen', 'living-room', 'toilet']`

Оба датасета были объединены, итоговые классы:  
`['bathroom', 'bedroom', 'hallway', 'kitchen', 'living-room', 'other', 'studio']`

## Модель

- **Детекционная модель**: Yolo11 (подробности о версии и параметрах далее).  
- **OCR модель**: EasyOCR.

## Данные на выход

- Размеченное изображение квартиры.  
- Таблица с информацией по комнатам.

---

## Ход работы

### 1. Kaggle

- Были найдены два описанных выше датасета.  
- Построен основной пайплайн для обучения и обработки данных в ноутбуке на Kaggle.  

#### Пайплайн:
1. **Обучение модели** на входных данных.  
2. **Предсказание** на файле или директории с файлами.  
3. Возврат массива результатов.  

Каждый элемент массива проходит следующие этапы:  
- Получение `boxes` (разметка) и `classes` (классы объектов).  
- Вырезание `box` по каждому классу и передача в EasyOCR.  
- OCR возвращает значение или ничего, если текст не распознан.  
- Данные сохраняются в словарь и добавляются в результирующий массив.  
- Результирующий массив оборачивается в `dataframe`.

#### Эксперименты:
- Пробовались разные модели (`n`, `s`, `m`, `l`) и гиперпараметры (аугментации, регуляризация, количество эпох).  
- Из-за переобучения на первом датасете (подписанные комнаты) пришлось вручную закрашивать текст. Обработано ~70% изображений.  
- Результаты разметки на тесте другого датасета без подписей стали лучше.

---

### 2. Local + Streamlit

- Создан проект в PyCharm и загружен на GitHub.  
- Добавлен код модели в `model.py` и веса `best.pt` с Kaggle.  
- В `app.py` описаны основные элементы веб-приложения:
  - Загрузка файлов.  
  - Отображение загруженных изображений.  
  - Обработка изображений.  
  - Вывод полученного датасета.  
  - Кнопки для скачивания.  

#### Улучшения обработки изображений:
- OCR возвращает не только значения, но и confidence.  
- Если confidence высок, площади для других комнат рассчитываются через отношение пиксельных площадей.  
- Для итоговых значений используется медиана (функция `estimate_footage`).  

#### Типы значений в датасете:
- **`ND`** (Not Detected) – комнату данного класса модель не обнаружила.  
- **`0`** – OCR не распознал число внутри комнаты.  
- **`{Number} est`** – приблизительная оценка (низкий confidence).  
- **`{Number}`** – число, распознанное с высокой уверенностью.  

#### Дополнения:
- Новые функции добавлены в проект.  
- Реализованы элементы в приложении:
  - Выдвижной список для изображений.  
  - Сохранение состояния кнопок и выводов через `st.session_state`.

